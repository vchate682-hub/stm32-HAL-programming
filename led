#include "stm32f4xx_hal.h"
#include <stdint.h>
/***********************************************************
 *    PROGRAM MACROS DEFINATION
 * *********************************************************
 */
#define   LED_PORT GPIOC
#define  LED_PIN  GPIO_PIN_12
#define  SW_PORT GPIOB
#define SW_PIN GPIO_PIN_0
/******************************************
 *  VARIBLE DELARATION
 * *******************************************
 */
uint8_t i=0;
volatile uint8_t count = 0;
volatile uint8_t flag = 0;

/*********************************************************************
 *   GPIO PIN  AND SWITCH Initialization Function
 * ******************************************************************
 */

static void GPIO_Init(void)
{
  GPIO_InitTypeDef GPIO_InitStruct = {0};

  __HAL_RCC_GPIOB_CLK_ENABLE();
  __HAL_RCC_GPIOC_CLK_ENABLE();

  HAL_GPIO_WritePin(GPIOC, GPIO_PIN_12, GPIO_PIN_RESET);

  /***************************************
   * Configure GPIO pin : PB0 */
  GPIO_InitStruct.Pin = GPIO_PIN_0;
  GPIO_InitStruct.Mode = GPIO_MODE_IT_FALLING;
  GPIO_InitStruct.Pull = GPIO_PULLUP;
  HAL_GPIO_Init(GPIOB, &GPIO_InitStruct);

  /*****************************************
   *Configure GPIO pin : PC12
   * **************************************** */
  GPIO_InitStruct.Pin = GPIO_PIN_12;
  GPIO_InitStruct.Mode = GPIO_MODE_OUTPUT_PP;
  GPIO_InitStruct.Pull = GPIO_NOPULL;
  GPIO_InitStruct.Speed = GPIO_SPEED_FREQ_LOW;
  HAL_GPIO_Init(GPIOC, &GPIO_InitStruct);

/********************************************************
 *     INTRRUPT ENABLE
 * ********************************************************/

    HAL_NVIC_SetPriorityGrouping(NVIC_PRIORITYGROUP_4);
    HAL_NVIC_SetPriority(EXTI0_IRQn,1, 0);
    HAL_NVIC_EnableIRQ(EXTI0_IRQn);


}
/*************************************************************
 *    CALLBACK FUNCTION
 * ***********************************************************/
void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin)
{
    static uint32_t last_count = 0;
    uint32_t current_count = HAL_GetTick();


    if (GPIO_Pin == SW_PIN && (current_count - last_count > 200))
    {
        count++;
        if(count >= 2)
        {
            flag = 1;
            count = 0;
        }
        last_count = current_count;
    }
}

/***********************************************************************
 *       EXTI0_IRQHandler
 * *******************************************************************/

void EXTI0_IRQHandler(void)
{

   HAL_GPIO_EXTI_IRQHandler(SW_PIN);
}
 /****************************************************************
  *
  *      MAIN FUNCTION
  * ****************************************************************/

  int main()
  {
	  HAL_Init();
	  	GPIO_Init();
	  	while(1)
	  	    {
	  	        if(flag)
	  	        {
	  	            HAL_GPIO_WritePin(LED_PORT, LED_PIN, GPIO_PIN_SET);
	  	            HAL_Delay(500);
	  	            HAL_GPIO_WritePin(LED_PORT, LED_PIN, GPIO_PIN_RESET);

	  	            flag = 0;
	  	        }
	  	    }

	   return 0;
  }
